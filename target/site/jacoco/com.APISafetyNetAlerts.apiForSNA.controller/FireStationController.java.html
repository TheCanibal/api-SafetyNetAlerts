<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FireStationController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">api</a> &gt; <a href="index.source.html" class="el_package">com.APISafetyNetAlerts.apiForSNA.controller</a> &gt; <span class="el_source">FireStationController.java</span></div><h1>FireStationController.java</h1><pre class="source lang-java linenums">package com.APISafetyNetAlerts.apiForSNA.controller;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.converter.json.MappingJacksonValue;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.APISafetyNetAlerts.apiForSNA.model.FireStation;
import com.APISafetyNetAlerts.apiForSNA.model.ListFireStations;
import com.APISafetyNetAlerts.apiForSNA.restModel.ListPersonAdaptative;
import com.APISafetyNetAlerts.apiForSNA.restModel.PersonAdaptative;
import com.APISafetyNetAlerts.apiForSNA.service.FireStationService;
import com.APISafetyNetAlerts.apiForSNA.service.PersonService;
import com.APISafetyNetAlerts.apiForSNA.util.FirestationPersonUtil;
import com.APISafetyNetAlerts.apiForSNA.util.FirestationUtil;
import com.APISafetyNetAlerts.apiForSNA.util.MedicalRecordUtil;
import com.APISafetyNetAlerts.apiForSNA.util.PersonUtil;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.ser.FilterProvider;
import com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;
import com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;

@RestController
<span class="fc" id="L36">public class FireStationController {</span>

    @Autowired
    private FirestationUtil fireStationUtil;

    @Autowired
    private MedicalRecordUtil medicalRecordUtil;

    @Autowired
    private FirestationPersonUtil firestationPersonUtil;

    @Autowired
    private PersonUtil personUtil;

    @Autowired
    private FireStationService firestationService;

    @Autowired
    private PersonService personService;

<span class="fc" id="L56">    private static Logger logger = LogManager.getLogger(FireStationController.class);</span>

    /**
     * Read - Get all Firestations
     * 
     * @return all firestations
     */
    @GetMapping(&quot;/firestations&quot;)
    public ListFireStations getAllFirestations() {
<span class="fc" id="L65">	return firestationService.getAllFireStations();</span>
    }

    /**
     * Read - Get all persons that are covered by a station
     * 
     * @param stationNumber firestation number
     * @return - A List of Persons that are covered by firestation and the number of
     *         minors and majors persons
     */
    @GetMapping(&quot;/firestation&quot;)
    public MappingJacksonValue getPersonsCoveredByFireStation(@RequestParam int stationNumber) {

	// List to return
<span class="fc" id="L79">	ListPersonAdaptative listToSend = new ListPersonAdaptative();</span>
	// List of station numbers
<span class="fc" id="L81">	List&lt;Integer&gt; stationNumbers = fireStationUtil.getAllStationNumber();</span>
	// Filter rules to apply to the bean
	SimpleBeanPropertyFilter monFiltre;
	// This allow the filter to apply to all the beans with dynamic filters
	FilterProvider filtres;
	// To be able to set the filters concretely
<span class="fc" id="L87">	MappingJacksonValue personFiltres = new MappingJacksonValue(listToSend);</span>
	try {
<span class="fc bfc" id="L89" title="All 2 branches covered.">	    if (stationNumbers.contains(stationNumber)) {</span>

		// List of person to browse the filtered list
<span class="fc" id="L92">		List&lt;PersonAdaptative&gt; listPersonsSorted = firestationPersonUtil</span>
<span class="fc" id="L93">			.getPersonsAdaptativeByFireStationNumber(stationNumber);</span>
		// Set the list Person in ListPerson class
<span class="fc" id="L95">		listToSend.setListPersons(listPersonsSorted);</span>

		// get number of majors
<span class="fc" id="L98">		int personnesMajeures = medicalRecordUtil.getNumberOfMajorsPersons(listPersonsSorted);</span>
		// get number of minors
<span class="fc" id="L100">		int personnesMineures = medicalRecordUtil.getNumberOfMinorsPersons(listPersonsSorted);</span>
<span class="fc" id="L101">		logger.info(&quot;Il y a {} personnes mineurs et {} personnes majeures dans la liste&quot;, personnesMineures,</span>
<span class="fc" id="L102">			personnesMajeures);</span>
<span class="fc" id="L103">		logger.info(&quot;Nombre de personnes dans la liste : {}&quot;, listToSend.getListPersons().size());</span>
		// set the amount of minors
<span class="fc" id="L105">		listToSend.setPersonnesMineures(personnesMineures);</span>
		// set the amount of majors
<span class="fc" id="L107">		listToSend.setPersonnesMajeures(personnesMajeures);</span>

		// Filters
<span class="fc" id="L110">		monFiltre = SimpleBeanPropertyFilter.filterOutAllExcept(&quot;firstName&quot;, &quot;lastName&quot;, &quot;address&quot;, &quot;phone&quot;,</span>
<span class="fc" id="L111">			&quot;personnesMajeures&quot;, &quot;personnesMineures&quot;);</span>
<span class="fc" id="L112">		filtres = new SimpleFilterProvider().addFilter(&quot;filtreDynamiquePerson&quot;, monFiltre);</span>
<span class="fc" id="L113">		personFiltres = new MappingJacksonValue(listToSend);</span>
<span class="fc" id="L114">		personFiltres.setFilters(filtres);</span>
		// Log the result if debug mode is enabled
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">		if (logger.isDebugEnabled()) {</span>
<span class="fc" id="L117">		    ObjectMapper objectMapper = new ObjectMapper();</span>
		    try {
<span class="fc" id="L119">			String json = objectMapper.setFilterProvider(filtres).writerWithDefaultPrettyPrinter()</span>
<span class="fc" id="L120">				.writeValueAsString(listToSend);</span>
<span class="fc" id="L121">			logger.debug(&quot;La liste de personnes qui est renvoyée : {}&quot;, json);</span>
<span class="pc" id="L122">		    } catch (Exception e) {</span>
<span class="nc" id="L123">			logger.error(&quot;Mapping error&quot;);</span>
		    }
		}
<span class="fc" id="L126">		return personFiltres;</span>
	    } else {
<span class="fc" id="L128">		throw new IllegalArgumentException(&quot;La station n'existe pas !&quot;);</span>
	    }
<span class="fc" id="L130">	} catch (IllegalArgumentException iae) {</span>
<span class="fc" id="L131">	    logger.error(&quot;La station numéro {} n'existe pas !&quot;, stationNumber);</span>
<span class="fc" id="L132">	    return personFiltres;</span>
	}

    }

    /**
     * Read - Get all persons who live at an address and the firestation number that
     * deserved the address
     * 
     * @param address address of a person
     * 
     * @return - A List of Persons who live at the address and the firestation
     *         number that deserved the address
     * 
     */

    @GetMapping(&quot;/fire&quot;)
    public MappingJacksonValue getPersonsLiveAtAddressDeservedByStation(@RequestParam String address) {
	// List to return
<span class="fc" id="L151">	List&lt;PersonAdaptative&gt; listToSend = new ArrayList&lt;PersonAdaptative&gt;();</span>
	// List to fill first before fill the list to return in case of wrong argument
<span class="fc" id="L153">	List&lt;PersonAdaptative&gt; listPersonsAdaptative = new ArrayList&lt;PersonAdaptative&gt;();</span>
	// List to compare the argument to the list of addresses
<span class="fc" id="L155">	List&lt;String&gt; allAddresses = personUtil.getAddressFromListPersons();</span>
<span class="fc" id="L156">	logger.debug(&quot;Liste de toutes les addresses : {}&quot;, allAddresses.toString());</span>
	// Filter rules to apply to the bean
	SimpleBeanPropertyFilter monFiltre;
	// This allow the filter to apply to all the beans with dynamic filters
	FilterProvider filtres;
	// To be able to set the filters concretely
<span class="fc" id="L162">	MappingJacksonValue personFiltres = new MappingJacksonValue(listToSend);</span>
	try {
<span class="fc bfc" id="L164" title="All 4 branches covered.">	    if (address != &quot;&quot; &amp;&amp; allAddresses.contains(address)) {</span>
		// Fill the list with a list of person who live at the address
<span class="fc" id="L166">		listPersonsAdaptative = personService.getPersonsAdaptativeByAdress(address).getListPersons();</span>
<span class="fc" id="L167">		logger.info(&quot;L'adresse est {}&quot;, address);</span>
		// Add the age of all persons in the list
<span class="fc" id="L169">		listToSend = medicalRecordUtil.getListOfPersonsWithAge(listPersonsAdaptative);</span>
		// Add the medical backgrounds to the list
<span class="fc" id="L171">		listToSend = medicalRecordUtil.getListPersonsWithTheirMedicalBackgrounds(listToSend);</span>
		// Add the firestations number to the list
<span class="fc" id="L173">		listToSend = fireStationUtil.getStationNumberByListPersons(listToSend);</span>
<span class="fc" id="L174">		logger.info(&quot;Nombre de personnes dans la liste : {}&quot;, listToSend.size());</span>
<span class="fc" id="L175">		monFiltre = SimpleBeanPropertyFilter.filterOutAllExcept(&quot;lastName&quot;, &quot;phone&quot;, &quot;firestationNumber&quot;, &quot;age&quot;,</span>
<span class="fc" id="L176">			&quot;medications&quot;, &quot;allergies&quot;);</span>
<span class="fc" id="L177">		filtres = new SimpleFilterProvider().addFilter(&quot;filtreDynamiquePerson&quot;, monFiltre);</span>
<span class="fc" id="L178">		personFiltres = new MappingJacksonValue(listToSend);</span>
<span class="fc" id="L179">		personFiltres.setFilters(filtres);</span>
		// Log the result if debug mode is enabled
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">		if (logger.isDebugEnabled()) {</span>
<span class="fc" id="L182">		    ObjectMapper objectMapper = new ObjectMapper();</span>
		    try {
<span class="fc" id="L184">			String json = objectMapper.setFilterProvider(filtres).writerWithDefaultPrettyPrinter()</span>
<span class="fc" id="L185">				.writeValueAsString(listToSend);</span>
<span class="fc" id="L186">			logger.debug(&quot;La liste de personnes qui est renvoyée : {}&quot;, json);</span>
<span class="pc" id="L187">		    } catch (Exception e) {</span>
<span class="nc" id="L188">			logger.error(&quot;Mapping error&quot;);</span>
		    }
		}
<span class="fc" id="L191">		return personFiltres;</span>
	    } else {
<span class="fc" id="L193">		throw new IllegalArgumentException(&quot;L'addresse est erronée !&quot;);</span>
	    }
<span class="fc" id="L195">	} catch (IllegalArgumentException e) {</span>
<span class="fc" id="L196">	    logger.error(&quot;L'addresse {} ne fait pas partie de la liste d'adresses !&quot;, address);</span>
<span class="fc" id="L197">	    return personFiltres;</span>
	}

    }

    /**
     * Read - Get all persons that are deserved by a list of firestation
     * 
     * @param stations array of stations
     * 
     * @return - A List of Persons that are deserved by firestations
     * 
     */

    @GetMapping(&quot;/flood/stations&quot;)
    public MappingJacksonValue getAllPersonsCoveredByFirestations(@RequestParam int[] stations) {
	// List to return
<span class="fc" id="L214">	List&lt;PersonAdaptative&gt; listToSend = new ArrayList&lt;PersonAdaptative&gt;();</span>
	// List to fill first before fill the list to return in case of wrong argument
<span class="fc" id="L216">	List&lt;PersonAdaptative&gt; listPersonsByFireStation = new ArrayList&lt;PersonAdaptative&gt;();</span>
	// list of all station number
<span class="fc" id="L218">	List&lt;Integer&gt; listStationsNumbers = fireStationUtil.getAllStationNumber();</span>
<span class="fc" id="L219">	logger.debug(&quot;Contenu de la liste des numéros de stations : {}&quot;, listStationsNumbers.toString());</span>
	// change array param into a list
<span class="fc" id="L221">	List&lt;Integer&gt; listStationsNumbersParam = Arrays.stream(stations).boxed().collect(Collectors.toList());</span>
<span class="fc" id="L222">	logger.debug(&quot;Contenu du paramètre \&quot;tableau de numéros de stations\&quot; : {}&quot;,</span>
<span class="fc" id="L223">		listStationsNumbersParam.toString());</span>
	// List of station to compare
<span class="fc" id="L225">	List&lt;Integer&gt; listStationsNumbersCompare = fireStationUtil</span>
<span class="fc" id="L226">		.compareElementsOfTwoListAndSendListWithSameElements(listStationsNumbersParam, listStationsNumbers);</span>
<span class="fc" id="L227">	logger.debug(&quot;Contenu de la liste qui enlève les doublons et les mauvais numéros de stations : {}&quot;,</span>
<span class="fc" id="L228">		listStationsNumbersCompare.toString());</span>
	// Filter rules to apply to the bean
	SimpleBeanPropertyFilter monFiltre;
	// This allow the filter to apply to all the beans with dynamic filters
	FilterProvider filtres;
	// To be able to set the filters concretely
<span class="fc" id="L234">	MappingJacksonValue personFiltres = new MappingJacksonValue(listToSend);</span>
	try {
<span class="fc bfc" id="L236" title="All 2 branches covered.">	    if (!listStationsNumbersCompare.isEmpty()) {</span>
<span class="fc" id="L237">		listPersonsByFireStation = firestationPersonUtil.getPersonsByListFireStations(stations);</span>
		// Add the age of all persons in the list
<span class="fc" id="L239">		listToSend = medicalRecordUtil.getListOfPersonsWithAge(listPersonsByFireStation);</span>
		// Add the medical backgrounds of all persons in the list
<span class="fc" id="L241">		listToSend = medicalRecordUtil.getListPersonsWithTheirMedicalBackgrounds(listToSend);</span>
		// Add the firestation number of all persons in the list
<span class="fc" id="L243">		listToSend = fireStationUtil.getStationNumberByListPersons(listToSend);</span>
<span class="fc" id="L244">		logger.info(&quot;Nombre de personnes dans la liste : {}&quot;, listToSend.size());</span>
<span class="fc" id="L245">		monFiltre = SimpleBeanPropertyFilter.filterOutAllExcept(&quot;lastName&quot;, &quot;phone&quot;, &quot;firestationNumber&quot;, &quot;age&quot;,</span>
<span class="fc" id="L246">			&quot;medications&quot;, &quot;allergies&quot;);</span>
<span class="fc" id="L247">		filtres = new SimpleFilterProvider().addFilter(&quot;filtreDynamiquePerson&quot;, monFiltre);</span>
<span class="fc" id="L248">		personFiltres = new MappingJacksonValue(listToSend);</span>
<span class="fc" id="L249">		personFiltres.setFilters(filtres);</span>
		// Log the result if debug mode is enabled
<span class="pc bpc" id="L251" title="1 of 2 branches missed.">		if (logger.isDebugEnabled()) {</span>
<span class="fc" id="L252">		    ObjectMapper objectMapper = new ObjectMapper();</span>
		    try {
<span class="fc" id="L254">			String json = objectMapper.setFilterProvider(filtres).writerWithDefaultPrettyPrinter()</span>
<span class="fc" id="L255">				.writeValueAsString(listToSend);</span>
<span class="fc" id="L256">			logger.debug(&quot;La liste de personnes qui est renvoyée : {}&quot;, json);</span>
<span class="pc" id="L257">		    } catch (Exception e) {</span>
<span class="nc" id="L258">			logger.error(&quot;Mapping error&quot;);</span>
		    }
		}
<span class="fc" id="L261">		return personFiltres;</span>
	    } else {
<span class="fc" id="L263">		throw new IllegalArgumentException(&quot;La liste de numéros de stations est erronée&quot;);</span>
	    }

<span class="fc" id="L266">	} catch (IllegalArgumentException e) {</span>
<span class="fc" id="L267">	    logger.error(&quot;La liste contient des numéros de stations qui sont incorrectes&quot;);</span>
<span class="fc" id="L268">	    return personFiltres;</span>
	}
    }

    /**
     * Create - Add new firestation to the JSON File
     * 
     * @param firestation firestation to add
     * @return created firestation
     */
    @PostMapping(&quot;/firestation&quot;)
    public void createFirestation(@RequestBody FireStation firestation) {
<span class="fc" id="L280">	firestationService.createFirestation(firestation);</span>
<span class="fc" id="L281">    }</span>

    /**
     * Update - station number of a fireStation
     * 
     * @param fireStation fireStation to update
     */
    @PutMapping(&quot;/firestation&quot;)
    public void updateFirestation(@RequestBody FireStation fireStation) {
<span class="fc" id="L290">	firestationService.updateFirestation(fireStation);</span>
<span class="fc" id="L291">    }</span>

    /**
     * Delete - Delete a firestation with address, number or both
     * 
     * @param firestation firestation to delete
     */
    @DeleteMapping(&quot;/firestation&quot;)
    public void deleteFirestation(@RequestBody FireStation fireStation) {
<span class="fc" id="L300">	firestationService.deleteFirestation(fireStation);</span>
<span class="fc" id="L301">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>